<div class="commits">
  <h3>Commits</h3>
  <% @non_pr_commits.each do |repo, commits| %>
    <ul class="<%= repo %>">
      <li class="repo_name"><strong><%= repo %></strong></li>
      <% commits.each do |commit| %>
        <li><a href="<%= commit.url %>"><%= commit.sha %></a> <%= commit.message %></a></li>
      <% end %>
    </ul>
  <% end %>
</div>

<div class="prs">
  <h3>Pull Requests</h3>
  <% @opened_prs.each do |repo, prs| %>
    <ul>
      <li class="repo_name"><strong><%= repo %></strong></li>
      <% prs.each do |pull_request| %>
        <li class="<%= pull_request.css_class %>">
          <%= pull_request.merged_badge %> <a href="<%= pull_request.url %>">#<%= pull_request.number %></a> <%= pull_request.title %>
          <a data-toggle="collapse" href="#commits<%= pull_request.number %>" class="collapsor">
            <i class="fa fa-caret-down"></i>
          </a>

          <div class="details collapse" id="commits<%= pull_request.number %>">
            <%= pull_request.body %>
            <ul>
              <% CommitDecorator.decorate_collection(Commit.where(repo: pull_request.repo, organization: pull_request.organization, pr_number: pull_request.number)).each do |commit| %>
                <li><a href="<%= commit.url %>"><%= commit.sha %></a> <%= commit.message %></a></li>
              <% end %>
            </ul>
          </div>
        </li>

      <% end %>
    </ul>
  <% end %>
</div>

<div class="issues">
  <h3>Issues Opened</h3>
  <% @opened_issues.each do |repo, issues| %>
    <ul>
      <li class="repo_name"><strong><%= repo %></strong></li>
      <% issues.each do |issue| %>
        <li class="<%= issue.css_class %>"><%= issue.closed_badge %> <a href="<%= issue.url %>">#<%= issue.number %></a> <%= issue.title %></li>
      <% end %>
    </ul>
  <% end %>
</div>

<div class="activity">
  <h3>Issue/PR activity</h3>

  <% @comments.each do |repo, comments| %>
    <ul>
      <li class="repo_name"><strong><%= repo %></strong></li>
      <% comments.group_by(&:number).each do |number, comments_by_number| %>
        <li>
          <%= comments_by_number.length %> comments on
          <a href="<%= comments_by_number.first.activity_url %>">#<%= number %></a>
        </li>
      <% end %>
      <li><strong>Total comments:</strong> <%= comments.length %></li>
    </ul>
  <% end %>
</div>
